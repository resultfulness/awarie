<script lang="ts">
  import Button, { Label } from "@smui/button";
  import CircularProgress from "@smui/circular-progress";
  import Dialog, { Actions, Content, Title } from "@smui/dialog";
  import Fab, { Icon } from "@smui/fab";
  import ReportComponent from "./ReportComponent.svelte";

  export const ssr = false;

  const proxyurl = "https://cors-anywhere.herokuapp.com/";

  const fetchData = async () => {
    const res = await fetch(proxyurl + "https://glitterworld.gq/get/reports/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        place_ids: [2, 3],
      }),
    });
    const data = await res.json();
    return data.reports;
  };

  let dialogOpen = false;

  function handleAdd() {
    dialogOpen = true;
  }
</script>

<Dialog bind:open={dialogOpen}>
  <Title>Dodaj awariÄ™</Title>
  <Content>
    Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequatur, quia?
  </Content>
  <Actions>
    <Button on:click={() => void 0}>
      <Label>No</Label>
    </Button>
    <Button on:click={() => void 0}>
      <Label>Yes</Label>
    </Button>
  </Actions>
</Dialog>

<div class="fab">
  <Fab color="primary" on:click={handleAdd}>
    <Icon class="material-symbols-outlined">add</Icon>
  </Fab>
</div>

{#await fetchData()}
  <div class="loader">
    <CircularProgress indeterminate style="height: 64px; width: 64px;" />
  </div>
{:then reports}
  {#each reports as report}
    <ReportComponent {report} />
  {/each}
{:catch error}
  <p>{error.message}</p>
{/await}

<style>
  .fab {
    position: fixed;
    z-index: 9999;
    bottom: 0;
    right: 0;
    padding: 1rem;
  }

  .loader {
    position: fixed;
    inset: 0;
    display: grid;
    place-items: center;
  }
</style>
